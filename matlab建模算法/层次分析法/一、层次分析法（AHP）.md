## 一、层次分析法（AHP）

### 1.基本原理

层次分析法是指将一个复杂的[多目标决策问题](https://baike.baidu.com/item/多目标决策问题/19143718)作为一个系统，将目标分解为多个目标或准则，进而分解为多指标（或准则、约束）的若干层次，通过定性指标模糊量化方法算出层次单排序（权数）和总排序，以作为目标（多指标）、多方案优化决策的系统方法。

层次分析法是将决策问题按总目标、各层子目标、评价准则直至具体的备投方案的顺序分解为不同的层次结构，然后用求解判断矩阵[特征向量](https://baike.baidu.com/item/特征向量/8663983)的办法，求得每一层次的各元素对**上一层次某元素的优先权重**，最后再加权和的方法递阶归并各备择方案对总目标的最终权重，此**最终权重最大者即为最优方案**。

层次分析法比较适合于具有**分层交错评价指标的目标系统**，而且[目标值](https://baike.baidu.com/item/目标值/2128232)又难于定量描述的决策问题。

### 2.层次分析法建模的步骤

1. 建立层次结构模型

   ​		将决策的目标、考虑的因素（决策准则）和决策对象按它们之间的相互关系分为最高层、中间层和最低层，绘出层次结构图。 **最高层是指决策的目的、要解决的问题。 最低层是指决策时的备选方案。 中间层是指考虑的因素、决策的准则。**对于相邻的两层，称高层为目标层，低层为因素层。

   ![image-20210127102042062](C:\Users\26292\AppData\Roaming\Typora\typora-user-images\image-20210127102042062.png)

2. 构造判断矩阵

   ​		如对某一准则，对其下的各方案进行两两对比，并按其重要性程度评定等级。

    $a_{ij}$为要素i与要素j重要性比较结果，表1列出Saaty给出的9个重要性等级及其赋值。按两两比较结果构成的矩阵称作[判断矩阵](https://baike.baidu.com/item/判断矩阵/1155781)。

   **表1** **比例标度表**

   | 因素i比因素j       | 量化值     |
   | ------------------ | ---------- |
   | 同等重要           | 1          |
   | 稍微重要           | 3          |
   | 较强重要           | 5          |
   | 强烈重要           | 7          |
   | 极端重要           | 9          |
   | 两相邻判断的中间值 | 2，4，6，8 |

   一个性质：

   $a_{ij}=\frac{1}{a_{ji}}$

   ![image-20210127102531241](C:\Users\26292\AppData\Roaming\Typora\typora-user-images\image-20210127102531241.png)

3. 层次单排序及其一致性检验

   ​		通常CR<0.1就认为该判断矩阵通过一致性检验，否则不具有满意一致性。

   [详细见该链接](https://baike.baidu.com/item/%E5%B1%82%E6%AC%A1%E5%88%86%E6%9E%90%E6%B3%95/1672)

4. 层次总排序及其一致性检验

### 3.实际建模

构造判断矩阵时主观定性的较多，不需要定量计算；

一般由专家给出：

Z最高层：决策

A中间层：要素

B最底层：方案

![image-20210127103745169](C:\Users\26292\AppData\Roaming\Typora\typora-user-images\image-20210127103745169.png)

$B_i$的矩阵代表B1，B2，B3在第i项决策因素比重之间的差别；

A的矩阵代表各个决策因素之间的比重差别。



![image-20210127104043853](C:\Users\26292\AppData\Roaming\Typora\typora-user-images\image-20210127104043853.png)

**做出决策**

A-Z的权重(5*1)：

|      | Z      |
| ---- | ------ |
| A1   | 0.2636 |
| A2   | 0.4758 |
| A3   | 0.0538 |
| A4   | 0.0981 |
| A5   | 0.1087 |

B-A的权重(3*5)：

|      | A1     | A2     | A3     | A4     | A5     |
| ---- | ------ | ------ | ------ | ------ | ------ |
| B1   | 0.5954 | 0.0819 | 0.4286 | 0.6337 | 0.1667 |
| B2   | 0.2764 | 0.2363 | 0.4286 | 0.1919 | 0.1667 |
| B3   | 0.1283 | 0.6817 | 0.1429 | 0.1744 | 0.6667 |

**最后决策的权重(3*1)：**

下面是各种决策的比重：
    0.2993
    0.2453
    0.4554

所以选择第几种方案
     3

### 4.实践问题

#### 4.1问题

买那个品牌的手机

#### 4.2建模

决策层：买那个品牌的手机（Z）

准则层：money，CPU，屏幕，内存，电池容量（A）

方案层：华为nova7 5G，魅族17 Pro，小米11（B）



#### 4.3估计参数

华为nova7 5G：2999/麒麟985 5G SoC 旗舰级芯片/6.57 英寸/8G/4000mAh

魅族17 Pro：4299/骁龙™ 865+X55 8 核心移动平台/ 三星定制 6.6 英寸 Super Amoled 屏幕 /8G/4500mAh 

小米11:3999/高通骁龙™888/DisplayMate A+ 2K + 120Hz AMOLED 四曲面柔性屏/8G/4600mAh

##### 构建矩阵

$
 A=\left[
 \begin{matrix}
1 & 1/2 & 1/3 & 1/2 & 1/3\\                                             2 & 1 & 2/3 & 1 & 2/3\\                                                 3 & 3/2 & 1 & 3/2 & 1\\                                                  2 & 1 & 2/3 & 1 & 2/3\\                                                 3 & 2/3 & 1 & 2/3 & 1\\
  \end{matrix}
  \right] 
$



$B_1=\left[\begin{matrix}1&1.43&1.33\\0.67&1&1.08\\0.75&0.93&1\end{matrix}\right]$

$B_2=\left[\begin{matrix}1&1.07&1.8\\0.93&1&1.68\\0.56&0.59&1\end{matrix}\right]$

$B_3=\left[\begin{matrix}1&1.8&2\\0.56&1&1.11\\0.5&0.95&1\end{matrix}\right]$

$B_4=\left[\begin{matrix}1&1&1\\1&1&1\\1&1&1\end{matrix}\right]$

$B_5=\left[\begin{matrix}1&1.13&1.15\\0.88&1&1.02\\0.87&0.98&1\end{matrix}\right]$

##### 计算权重

A-Z的权重(5*1)：

|      | Z      |
| ---- | ------ |
| A1   | 0.0971 |
| A2   | 0.1942 |
| A3   | 0.2912 |
| A4   | 0.1942 |
| A5   | 0.2234 |

B-A的权重(3*5)：

|      | A1     | A2     | A3     | A4     | A5     |
| ---- | ------ | ------ | ------ | ------ | ------ |
| B1   | 0.4096 | 0.4019 | 0.4840 | 0.3333 | 0.3633 |
| B2   | 0.2971 | 0.3748 | 0.2695 | 0.3333 | 0.3211 |
| B3   | 0.2933 | 0.2233 | 0.2465 | 0.3333 | 0.3156 |

##### 带入程序，做出决策

请输入A到Z的权重矩阵：
A-Z=[0.0971    
0.1942
0.2912
0.1942
0.2234]
请输入B到A的权重矩阵：
B-A=[0.4096 0.4019 0.4840 0.3333 0.3633
0.2971 0.3748 0.2695 0.3333 0.3211
0.2933 0.2233 0.2465 0.3333 0.3156]
下面是各种决策的比重：
    0.4047
    0.3166
    0.2789

最终选择的手机为：
华为nova7